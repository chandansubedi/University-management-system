{% extends 'staff_template/base_template.html' %}
{% load static %}

{% block page_title %}
File Details
{% endblock page_title %}

{% block main_content %}
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="{{ file.get_file_icon }}"></i> {{ file.title }}
                        </h3>
                        <div class="card-tools">
                            <a href="{% url 'download_file' file.id %}" class="btn btn-success btn-sm">
                                <i class="fas fa-download"></i> Download
                            </a>
                            <a href="{% url 'staff_delete_file' file.id %}" 
                               class="btn btn-danger btn-sm"
                               onclick="return confirm('Are you sure you want to delete this file?')">
                                <i class="fas fa-trash"></i> Delete
                            </a>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>File Type:</strong></td>
                                        <td>{{ file.get_file_type_display }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>File Size:</strong></td>
                                        <td>{{ file.get_file_size_display }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Subject:</strong></td>
                                        <td>{{ file.subject.subject_name }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Session:</strong></td>
                                        <td>{{ file.session.session_start_year }} - {{ file.session.session_end_year }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Uploaded By:</strong></td>
                                        <td>{{ file.uploaded_by.admin.first_name }} {{ file.uploaded_by.admin.last_name }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Upload Date:</strong></td>
                                        <td>{{ file.uploaded_at|date:"F d, Y \a\t g:i A" }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Downloads:</strong></td>
                                        <td>{{ file.download_count }}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>Status:</strong></td>
                                        <td>
                                            {% if file.is_active %}
                                                <span class="badge badge-success">Active</span>
                                            {% else %}
                                                <span class="badge badge-danger">Inactive</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><strong>Visibility:</strong></td>
                                        <td>
                                            {% if file.is_public %}
                                                <span class="badge badge-info">Public</span>
                                            {% else %}
                                                <span class="badge badge-warning">Private</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% if file.category %}
                                    <tr>
                                        <td><strong>Category:</strong></td>
                                        <td>
                                            <span class="badge" style="background-color: {{ file.category.color }};">
                                                {{ file.category.name }}
                                            </span>
                                        </td>
                                    </tr>
                                    {% endif %}
                                    <tr>
                                        <td><strong>Last Updated:</strong></td>
                                        <td>{{ file.updated_at|date:"F d, Y \a\t g:i A" }}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        
                        {% if file.description %}
                            <div class="mt-4">
                                <h5>Description</h5>
                                <div class="alert alert-info">
                                    {{ file.description|linebreaks }}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="card-footer">
                        <a href="{% url 'staff_view_files' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Back to Files
                        </a>
                        <a href="{% url 'download_file' file.id %}" class="btn btn-success">
                            <i class="fas fa-download"></i> Download File
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card card-info">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-bar"></i> File Statistics
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="info-box">
                            <span class="info-box-icon bg-info">
                                <i class="fas fa-download"></i>
                            </span>
                            <div class="info-box-content">
                                <span class="info-box-text">Total Downloads</span>
                                <span class="info-box-number">{{ file.download_count }}</span>
                            </div>
                        </div>
                        
                        <div class="info-box">
                            <span class="info-box-icon bg-success">
                                <i class="fas fa-calendar"></i>
                            </span>
                            <div class="info-box-content">
                                <span class="info-box-text">Days Since Upload</span>
                                <span class="info-box-number">{{ file.uploaded_at|timesince }}</span>
                            </div>
                        </div>
                        
                        <div class="info-box">
                            <span class="info-box-icon bg-warning">
                                <i class="fas fa-file"></i>
                            </span>
                            <div class="info-box-content">
                                <span class="info-box-text">File Extension</span>
                                <span class="info-box-number">{{ file.get_file_extension|upper }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock main_content %}
